generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Role {
  CUSTOMER
  STAFF
  ADMIN
}

enum ProductType {
  HEALTH
  LIFE
  MOTOR
  TRAVEL
}

enum QuoteStatus {
  PENDING
  APPROVED
  REJECTED
}

enum PolicyStatus {
  ACTIVE
  EXPIRED
  CANCELLED
}

enum ClaimStatus {
  RECEIVED
  IN_REVIEW
  APPROVED
  REJECTED
  PAID
}

model User {
  id        Int      @id @default(autoincrement())
  email     String   @unique
  password  String
  role      Role     @default(CUSTOMER)
  name      String
  createdAt DateTime @default(now())
  quotes    Quote[]
  policies  Policy[]
  claims    Claim[]
}

model Product {
  id          Int           @id @default(autoincrement())
  name        String
  type        ProductType
  description String
  basePremium Float
  exclusions  Json
  createdAt   DateTime      @default(now())
  quotes      Quote[]
  policies    Policy[]
}

model Quote {
  id         Int         @id @default(autoincrement())
  user       User        @relation(fields: [userId], references: [id])
  userId     Int
  product    Product     @relation(fields: [productId], references: [id])
  productId  Int
  premium    Float
  status     QuoteStatus @default(PENDING)
  metadata   Json
  createdAt  DateTime    @default(now())
  policy     Policy?
}

model Policy {
  id          Int         @id @default(autoincrement())
  policyNumber String      @unique
  quote       Quote       @relation(fields: [quoteId], references: [id])
  quoteId     Int
  product     Product     @relation(fields: [productId], references: [id])
  productId   Int
  user        User        @relation(fields: [userId], references: [id])
  userId      Int
  premium     Float
  startDate   DateTime
  endDate     DateTime
  premiumPaid Boolean     @default(false)
  status      PolicyStatus @default(ACTIVE)
  claims      Claim[]
  createdAt   DateTime    @default(now())
}

model Claim {
  id           Int         @id @default(autoincrement())
  policy       Policy      @relation(fields: [policyId], references: [id])
  policyId     Int
  user         User        @relation(fields: [userId], references: [id])
  userId       Int
  claimType    ProductType
  amount       Float
  incidentDate DateTime
  description  String
  status       ClaimStatus @default(RECEIVED)
  attachments  Json?
  createdAt    DateTime    @default(now())
}
